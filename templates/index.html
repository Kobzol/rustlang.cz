{% extends "base.html" %}

{% macro sectionheader(id, label, tooltip) %}
<div class="card-title">
  <div class="accordion" id="accordion-{{ id }}">
    <div class="accordion-item">
      <h5 class="accordion-header">
        <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse"
                data-bs-target="#{{ id }}">
          {{ label }}
        </button>
      </h5>
      <div id="{{ id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ id }}">
        <div class="accordion-body">{{ tooltip }}</div>
      </div>
    </div>
  </div>
</div>
{% endmacro sectionheader %}

{% macro simplelist(id, label, data, tooltip, t, lang) %}
<div class="col-md-4 col-12">
  <div class="card">
    <div class="card-body">
      {{ self::sectionheader(id=id, label=label, tooltip=tooltip) }}
      <ul class="list-group list-group-flush">
        {% for entry in data %}
        <a href="{{ entry.link }}"
           target="_blank"
           class="list-group-item list-group-item-action"
        >
          <div class="d-flex justify-content-between align-items-center">
            <div>
              {{ entry.name }}
            </div>
            {% if entry.kind %}
            {% set kind_key = "kind_" ~ entry.kind | lower | replace(from=" ", to="_") %}
            <span class="badge text-bg-secondary">{% if t[kind_key] %}{{ t[kind_key][lang] }}{% else %}{{ entry.kind }}{% endif %}</span>
            {% endif %}
          </div>
          {% if entry.date %}
          <small class="text-body-secondary">{{ entry.date | date(format="%d. %m. %Y %H:%M") }}</small>
          {% endif %}
        </a>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>
{% endmacro simplelist %}

{% block content %}

{% set t = load_data(path="data/translations.yaml") %}

<div class="fs-4 py-4">
  {{ t.intro_text[lang] }}
  {{ t.intro_contributions[lang] }} <a href="{{ config.extra.github_url }}">{{ t.intro_contributions_link[lang] }}</a>!
  {{ t.intro_subscribe_prefix[lang] }} <a href="{{ get_url(path='feed.xml') }}">{{ t.intro_subscribe_link[lang] }}</a>{{ t.intro_subscribe_suffix[lang] }}
</div>

{% set communities = load_data(path="data/communities.yaml") %}
{% set events = load_data(path="data/events.yaml") %}
{% set recordings = load_data(path="data/recordings.yaml") %}
{% set education = load_data(path="data/education.yaml") %}
{% set trainings = load_data(path="data/trainings.yaml") %}
{% set companies = load_data(path="data/companies.yaml") %}

<div class="container px-4">
  <div class="row g-4">
    {{ self::simplelist(id="communities", label=t.section_communities[lang], data=communities, tooltip=t.tooltip_communities[lang], t=t, lang=lang) }}
    {{ self::simplelist(id="events", label=t.section_events[lang], data=events, tooltip=t.tooltip_events[lang], t=t, lang=lang) }}
    <div class="col-md-4 col-12">
      <div class="card">
        <div class="card-body">
          {{ self::sectionheader(id="recordings", label=t.section_recordings[lang], tooltip=t.tooltip_recordings[lang]) }}
          <ul class="list-group list-group-flush">
            {% for recording in recordings %}
            <a href="{{ recording.link }}" target="_blank"
               class="list-group-item list-group-item-action">
              <div class="d-flex justify-content-between align-items-center">
                <div>{{ recording.name }}</div>
                {% if recording.kind %}
                {% set kind_key = "kind_" ~ recording.kind | lower | replace(from=" ", to="_") %}
                <span class="badge text-bg-secondary">{% if t[kind_key] %}{{ t[kind_key][lang] }}{% else %}{{ recording.kind }}{% endif %}</span>
                {% endif %}
              </div>
              <div class="fs-6 text-body-secondary">
                {{ recording.speakers | join(sep=", ") }}
              </div>
              {% if recording.date %}
              <small class="text-body-secondary">{{ recording.date | date(format="%d. %m. %Y") }}</small>
              {% endif %}
            </a>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    {{ self::simplelist(id="education", label=t.section_education[lang], data=education, tooltip=t.tooltip_education[lang], t=t, lang=lang) }}
    {{ self::simplelist(id="trainings", label=t.section_trainings[lang], data=trainings, tooltip=t.tooltip_trainings[lang], t=t, lang=lang) }}
    <div class="col-md-4 col-12">
      <div class="card">
        <div class="card-body">
          {{ self::sectionheader(id="companies", label=t.section_companies[lang], tooltip=t.tooltip_companies[lang]) }}
          <ul class="list-group list-group-flush">
            {% for company in companies %}
            <li class="list-group-item">
                <div class="card-title">{{ company.name }}</div>
                <a href="{{ company.link }}" class="card-link" target="_blank">{{ t.link_home[lang] }}</a>
                {% for entry in company.entries | default(value=[]) %}
                <a href="{{ entry.link }}" target="_blank" class="card-link">{{ entry.name }}</a>
                {% endfor %}
            </li>
           {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %}
